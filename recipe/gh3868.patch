From e6dee429d30bd56d9495a295e637ce92910d22a6 Mon Sep 17 00:00:00 2001
From: Isuru Fernando <isuruf@gmail.com>
Date: Tue, 4 Feb 2020 19:26:30 -0600
Subject: [PATCH 1/4] Ignore run_exports of python for noarch: python

---
 conda_build/render.py | 6 +++++-
 1 file changed, 5 insertions(+), 1 deletion(-)

diff --git a/conda_build/render.py b/conda_build/render.py
index 2312b3cda..473d18412 100644
--- a/conda_build/render.py
+++ b/conda_build/render.py
@@ -352,7 +352,11 @@ def get_upstream_pins(m, actions, env):
     linked_packages = actions.get('LINK', [])
     linked_packages = [pkg for pkg in linked_packages if pkg.name in explicit_specs]
 
-    ignore_list = utils.ensure_list(m.get_value('build/ignore_run_exports'))
+    default_ignore_exports = []
+    if m.noarch or m.noarch_python:
+        default_ignore_exports = ['python']
+
+    ignore_list = utils.ensure_list(m.get_value('build/ignore_run_exports', default_ignore_exports))
     additional_specs = {}
     for pkg in linked_packages:
         run_exports = None

From d4a825d15c9393c97c7fac91129daeb129727d61 Mon Sep 17 00:00:00 2001
From: Isuru Fernando <isuruf@gmail.com>
Date: Tue, 4 Feb 2020 19:28:20 -0600
Subject: [PATCH 2/4] Fix preprocesing selector py for python with build string

---
 conda_build/metadata.py | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/conda_build/metadata.py b/conda_build/metadata.py
index a89d5f05b..bb04648a5 100644
--- a/conda_build/metadata.py
+++ b/conda_build/metadata.py
@@ -95,7 +95,7 @@ def ns_cfg(config):
     # there are times when python comes in as a tuple
     if not hasattr(py, 'split'):
         py = py[0]
-    py = int("".join(py.split('.')[:2]))
+    py = int("".join(py.split(' ')[0].split('.')[:2]))
 
     d.update(dict(py=py,
                     py3k=bool(30 <= py < 40),

From 7cb355f559884b010d3f3887ef594c3f61067636 Mon Sep 17 00:00:00 2001
From: Isuru Fernando <isuruf@gmail.com>
Date: Thu, 6 Feb 2020 11:40:41 -0600
Subject: [PATCH 3/4] Add comment on splitting with space

---
 conda_build/metadata.py | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/conda_build/metadata.py b/conda_build/metadata.py
index bb04648a5..290de96e1 100644
--- a/conda_build/metadata.py
+++ b/conda_build/metadata.py
@@ -95,6 +95,8 @@ def ns_cfg(config):
     # there are times when python comes in as a tuple
     if not hasattr(py, 'split'):
         py = py[0]
+    # go from "3.6 *_cython" -> "36"
+    # or from "3.6.9" -> "36"
     py = int("".join(py.split(' ')[0].split('.')[:2]))
 
     d.update(dict(py=py,

From 917de4b73086a7896d20a9534b0e84d90ced34e9 Mon Sep 17 00:00:00 2001
From: Isuru Fernando <isuruf@gmail.com>
Date: Thu, 6 Feb 2020 11:58:54 -0600
Subject: [PATCH 4/4] Add test for python version change

---
 .../metadata/_noarch_python/conda_build_config.yaml             | 2 ++
 1 file changed, 2 insertions(+)
 create mode 100644 tests/test-recipes/metadata/_noarch_python/conda_build_config.yaml

diff --git a/tests/test-recipes/metadata/_noarch_python/conda_build_config.yaml b/tests/test-recipes/metadata/_noarch_python/conda_build_config.yaml
new file mode 100644
index 000000000..6650d0bd5
--- /dev/null
+++ b/tests/test-recipes/metadata/_noarch_python/conda_build_config.yaml
@@ -0,0 +1,2 @@
+python:
+- "3.6 *"
